{"version":3,"sources":["tools/UpdateVersions.js"],"names":["async","sdkVersion","reactNativeTag","facebookRNVersion","let","versions","await","Versions","versionsAsync","sdkVersions","expoReactNativeTag","facebookReactNativeVersion","setVersionsAsync","updateSdkVersionsAsync","s3Client","pathToApp","appVersion","tempAppPath","path","join","process","cwd","spawnAsync","stdio","file","fs","createReadStream","console","log","promise","putObject","Bucket","Key","Body","ACL","updateIOSSimulatorBuild","updateAndroidApk"],"mappings":";;;;;;;;;;+BASOA,WACLC,UADKD,EAELE,cAFKF,EAGLG,iBAHKH,EAIL;AACAI,QAAIC,WAAWC,MAAMC,gCAASC,aAATD,EAArBH;AACAC,aAASI,WAATJ,CAAqBJ,UAArBI,iBACKA,SAASI,WAATJ,CAAqBJ,UAArBI,CADLA;AAEEK,0BAAoBR,cAFtBG;AAGEM,kCAA4BR;AAH9BE;AAKAC,UAAMC,gCAASK,gBAATL,CAA0BF,QAA1BE,CAAND;AACF,G;;kBAZsBO,sB;;;;;;gCAcfb,WACLc,QADKd,EAELe,SAFKf,EAGLgB,UAHKhB,EAIL;AACAI,QAAIa,cAAcC,cAAKC,IAALD,CAAUE,QAAQC,GAARD,EAAVF,EAAyB,iBAAzBA,CAAlBd;;AAEAE,UAAMgB,iDAAW,KAAXA,EAAkB,CAAC,OAAD,EAAUL,WAAV,EAAuB,IAAvB,EAA6BF,SAA7B,EAAwC,GAAxC,CAAlBO,EAAgE;AACpED,WAAKD,QAAQC,GAARD,EAD+D;AAEpEG,aAAO,CAAC,QAAD,EAAW,QAAX,EAAqB,SAArB,CAF6D,EAAhED,CAANhB;;AAKAF,QAAIoB,OAAOC,YAAGC,gBAAHD,CAAoBR,WAApBQ,CAAXrB;;AAEAuB,YAAQC,GAARD,CAAY,cAAZA;;AAEArB,UAAMQ,SAASe,OAATf,CAAiBgB,SAAjBhB,CAA2B;AAC/BiB,cAAQ,wBADuB;AAE/BC,WAAM,YAAWhB,UAAW,SAFG;AAG/BiB,YAAMT,IAHyB;AAI/BU,WAAK;AAJ0B,KAA3BpB,CAANR;;AAOAA,UAAMgB,iDAAW,IAAXA,EAAiB,CAACL,WAAD,CAAjBK,CAANhB;;AAEAqB,YAAQC,GAARD,CAAY,4BAAZA;;AAEAvB,QAAIC,WAAWC,MAAMC,gCAASC,aAATD,EAArBH;AACAC,aAAS,YAATA,IAAyBW,UAAzBX;AACAA,aACE,QADFA,IAEK,iDAAgDW,UAAW,SAFhEX;AAGAC,UAAMC,gCAASK,gBAATL,CAA0BF,QAA1BE,CAAND;AACF,G;;kBAjCsB6B,uB;;;;;;gCAmCfnC,WACLc,QADKd,EAELe,SAFKf,EAGLgB,UAHKhB,EAIL;AACAI,QAAIoB,OAAOC,YAAGC,gBAAHD,CAAoBV,SAApBU,CAAXrB;;AAEAuB,YAAQC,GAARD,CAAY,cAAZA;;AAEArB,UAAMQ,SAASe,OAATf,CAAiBgB,SAAjBhB,CAA2B;AAC/BiB,cAAQ,kBADuB;AAE/BC,WAAM,YAAWhB,UAAW,MAFG;AAG/BiB,YAAMT,IAHyB;AAI/BU,WAAK;AAJ0B,KAA3BpB,CAANR;;AAOAqB,YAAQC,GAARD,CAAY,4BAAZA;;AAEAvB,QAAIC,WAAWC,MAAMC,gCAASC,aAATD,EAArBH;AACAC,aAAS,gBAATA,IAA6BW,UAA7BX;AACAA,aACE,YADFA,IAEK,kDAAiDW,UAAW,MAFjEX;AAGAC,UAAMC,gCAASK,gBAATL,CAA0BF,QAA1BE,CAAND;AACF,G;;kBAxBsB8B,gB;;;;;AAtDtB;;AACA;;;;AACA;AAAA;AAAA;;;;AACA;AAAA;AAAA","file":"../../tools/UpdateVersions.js","sourcesContent":["/**\n * @flow\n */\n\nimport fs from 'fs';\nimport path from 'path';\nimport spawnAsync from '@exponent/spawn-async';\nimport * as Versions from '../Versions';\n\nexport async function updateSdkVersionsAsync(\n  sdkVersion: string,\n  reactNativeTag: string,\n  facebookRNVersion: string\n) {\n  let versions = await Versions.versionsAsync();\n  versions.sdkVersions[sdkVersion] = {\n    ...versions.sdkVersions[sdkVersion],\n    expoReactNativeTag: reactNativeTag,\n    facebookReactNativeVersion: facebookRNVersion,\n  };\n  await Versions.setVersionsAsync(versions);\n}\n\nexport async function updateIOSSimulatorBuild(\n  s3Client: any,\n  pathToApp: string,\n  appVersion: string\n) {\n  let tempAppPath = path.join(process.cwd(), 'temp-app.tar.gz');\n\n  await spawnAsync('tar', ['-zcvf', tempAppPath, '-C', pathToApp, '.'], {\n    cwd: process.cwd(),\n    stdio: ['ignore', 'ignore', 'inherit'], // only stderr\n  });\n\n  let file = fs.createReadStream(tempAppPath);\n\n  console.log('Uploading...');\n\n  await s3Client.promise.putObject({\n    Bucket: 'exp-ios-simulator-apps',\n    Key: `Exponent-${appVersion}.tar.gz`,\n    Body: file,\n    ACL: 'public-read',\n  });\n\n  await spawnAsync('rm', [tempAppPath]);\n\n  console.log('Adding to server config...');\n\n  let versions = await Versions.versionsAsync();\n  versions['iosVersion'] = appVersion;\n  versions[\n    'iosUrl'\n  ] = `https://dpq5q02fu5f55.cloudfront.net/Exponent-${appVersion}.tar.gz`;\n  await Versions.setVersionsAsync(versions);\n}\n\nexport async function updateAndroidApk(\n  s3Client: any,\n  pathToApp: string,\n  appVersion: string\n) {\n  let file = fs.createReadStream(pathToApp);\n\n  console.log('Uploading...');\n\n  await s3Client.promise.putObject({\n    Bucket: 'exp-android-apks',\n    Key: `Exponent-${appVersion}.apk`,\n    Body: file,\n    ACL: 'public-read',\n  });\n\n  console.log('Adding to server config...');\n\n  let versions = await Versions.versionsAsync();\n  versions['androidVersion'] = appVersion;\n  versions[\n    'androidUrl'\n  ] = `https://d1ahtucjixef4r.cloudfront.net/Exponent-${appVersion}.apk`;\n  await Versions.setVersionsAsync(versions);\n}\n"],"sourceRoot":"/xdl/src"}